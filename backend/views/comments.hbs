
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Comments page</title>
<link rel="stylesheet" href="/styles.css">
</head>
<body>
    {{> header title="Comments" }}

	{{!-- Display the comments and pagination, as well as the new comment button if the user is logged in --}}    
    <h2>List of all comments</h2>
	<p>
        {{#if user.isLoggedIn}}
		<form method="GET" action="/comment/new" style="display: inline;">
            <button type="submit">Create New Comment</button>
        </form>
        {{/if}}
    </p>
    <ul id="dynamic-list"></ul> <!-- Placeholder for the list, populated in the script -->
    <div class="pagination" id="pagination">
        {{#if data.current_page > 1}}
            <a href="/comments?page={{data.current_page - 1}}">&laquo;</a>
        {{/if}}
        <div id="numbers"></div> <!-- Placeholder for the numbers, populated in the script -->
        {{#if data.current_page < data.total_pages}}
            <a href="/comments?page={{data.current_page + 1}}">&raquo;</a>
        {{/if}}
    </div>
    <script>
        const comments = {{{ comments }}};

        // Render the pagination links
        const numbersDiv = document.getElementById("numbers");
        for (let i = 1; i <= data.total_pages; i++) {
            const item = document.createElement("a");
            item.textContent = `${i}`;
            item.href = `/comments?page=${i}`;
            if (i === data.current_page){ item.focus(); }
            numbersDiv.appendChild(item);
        }
        // Render the comments
        const MAX_LENGTH = 150;
        const list = document.getElementById("dynamic-list");
        comments.forEach(item => {
            const listItem = document.createElement("li");
            const fullText = `${item.body} - ${item.author}, ${item.timeposted}`;
            listItem.style.color = item.color;

            // Check how long the comment is
            const isLong = fullText.length > MAX_LENGTH;
            const textSpan = document.createElement("span");
            const button = document.createElement("button");

            textSpan.textContent = isLong
                ? fullText.slice(0, MAX_LENGTH) + "..."
                : fullText;
            // If the comment is longer than 150 characters, create the truncatable version
            if (isLong) {
                button.textContent = "Read more";
                button.style.marginLeft = "6px";
                button.style.cursor = "pointer";

                let expanded = false;

                button.addEventListener("click", () => {
                    expanded = !expanded;
                    textSpan.textContent = expanded
                        ? fullText
                        : fullText.slice(0, MAX_LENGTH) + "...";
                    button.textContent = expanded ? "Read less" : "Read more";
                });

                listItem.appendChild(textSpan);
                listItem.appendChild(button);
            } else {
                listItem.appendChild(textSpan);
            }
            list.appendChild(listItem);
        });
    </script>
{{> footer}}
</body>
</html>

